<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>立瑋數位科技 台銀資料</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

    <!-- fonts style -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

    <!--owl slider stylesheet -->
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

    <!-- font awesome style -->
    <link href="css/font-awesome.min.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="css/responsive.css" rel="stylesheet" />
    <style>
        form {
            text-align: center;
            margin: 0 auto;
        }

        select,
        input {
            width: 200px;
            margin: 0 auto;
            padding: 10px;
            border-radius: 5px;
            background-color: azure;
            line-height: normal;
        }

        body {
            font-family: Arial, sans-serif;
        }

        table {
            margin: 0 auto;
            width: 90%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
        }

        th {
            background-color: #a0d6b4;
        }

        tr:nth-child(even) {
            background-color: #eaf7dc;
        }

        #pagination>button {
            width: 36px;
            height: 36px;
            margin: 0 10px;
        }
    </style>
</head>

<body>
    <div class="hero_area">
        <div class="hero_bg_box">
            <div class="bg_img_box">
                <img src="images/hero-bg.png" alt="">
            </div>
        </div>
        <header class="header_section">
            <div class="container-fluid">
                <nav class="navbar navbar-expand-lg custom_nav-container ">
                    <a class="navbar-brand" href="index.html">
                        <span>
                            立瑋數位科技
                        </span>
                    </a>

                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class=""> </span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav  ">
                            <li class="nav-item active">
                                <a class="nav-link" href="index.html">首頁 <span class="sr-only">(current)</span></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">檔案下載</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="./product.html"> 台銀資料</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#services"> 服務內容</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#about">關於立瑋</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#special">立瑋特色</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://mail.liweidt.com/webmail">Web郵件</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="http://repair.liweidt.com:8000/login.html" target="_blank"> <i
                                        class="fa fa-user" aria-hidden="true"></i>維修系統</a>
                            </li>
                            <form class="form-inline">
                                <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </button>
                            </form>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
        <!-- <section class="slider_section ">
            <div id="customCarousel1" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="container ">
                            <div class="row">
                                <div class="col-md-6 ">
                                    <div class="detail-box">
                                        <h1>
                                            立瑋 <br>
                                            數位科技
                                        </h1>
                                        <p>
                                            軟硬體整合，一站到位
                                            我們提供全方位的數位解決方案，從硬體設備、軟體開發到系統整合，皆能滿足您的需求。
                                        </p>
                                        <div class="btn-box">
                                            <a href="" class="btn1">
                                                查看更多
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="img-box">
                                        <img src="images/slider-img.png" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ol class="carousel-indicators">
                    <li data-target="#customCarousel1" data-slide-to="0" class="active"></li>
                </ol>
            </div>

        </section> -->
        <!-- end slider section -->
    </div>


<main class="container">
    <h2 style="text-align: center; margin-bottom: 30px;margin-top: 30px;">共約清單</h2>

    <section style="margin-bottom:18px">
	<div class="panel search-box" style="margin: 15px auto;text-align: center;">
          <label for="hw"></label>
          <select id="hw">
            <option value="">— 請選擇商品分類 —</option>
          </select>
		
          <label for="sw"></label>
          <select id="sw" disabled>
            <option value="">— 請先選擇商品分類 —</option>
          </select>
		
		
          <label for="q"></label>
          <input id="q" type="text" placeholder="輸入型號、關鍵字、產地…">
	</div>
    </section>




    <div id="pagination" style="margin: 15px auto;text-align: center;"></div>

    <!-- 桌機：表格（外層加水平捲動容器） -->
    <div class="table-wrap" style="margin-bottom: 30px;">
      <table id="listTable"></table>
    </div>


</main>


 <table id="listTable" style="margin-bottom: 30px;"></table>
    <section class="info_section layout_padding2">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-3 info_col">
                    <div class="info_contact">
                        <h4>
                            通訊地址
                        </h4>
                        <div class="contact_link_box">
                            <a href="https://www.google.com/maps?q=23.142394164882102, 120.21569992811409">
                                <i class="fa fa-map-marker" aria-hidden="true"></i>
                                <span>
                                    總公司 : 台南市西港區後營里後營236號1樓
                                </span>
                            </a>
                            <a href="https://www.google.com/maps?q=23.305933381933155, 120.3218840678165">
                                <i class="fa fa-map-marker" aria-hidden="true"></i>
                                <span>
                                    辦事處 : 台南市新營區新進路37號6樓之2
                                </span>
                            </a>
                            <a href="">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                                <span>
                                    電話:06-6331398
                                </span>
                            </a>
                            <a href="mailto:andy.liweidt@gmail.com?subject=官網郵件">
                                <i class="fa fa-envelope" aria-hidden="true"></i>
                                <span>
                                    liweidt@liweidt.com
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 info_col">
                    <div class="info_detail">
                        <h4>
                            聯絡我們
                        </h4>
                        <p>
                            無論您是企業、學校或個人，我們都能為您提供最完善的服務。
                        </p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-2 mx-auto info_col">
                    <div class="info_link_box">
                        <h4>
                            連結
                        </h4>
                        <div class="info_links">
                            <a class="active" href="index.html">
                                首頁
                            </a>
                            <a class="" href="#about">
                                關於我們
                            </a>
                            <a class="" href="#services">
                                服務內容
                            </a>
                            <a class="" href="#special">
                                立瑋特色
                            </a>
                            <a class="" href="#">
                                立瑋團隊
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 info_col ">
                    <h4>
                        關注立瑋
                    </h4>
                    <form action="#">
                        <input type="text" placeholder="輸入電子信箱" />
                        <button type="submit">
                            獲取通知
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <section class="footer_section">
        <div class="container">
            <p>
                <a href="https://html.design/">立瑋數位科技</a>
                版權所有 &copy;
                <span id="displayYear"></span>
            </p>
        </div>
    </section>

  <script>
    // 年份與行動選單
    const toggle = document.querySelector('.menu-toggle');
    const menuEl = document.getElementById('menu');
    if (toggle && menuEl) toggle.addEventListener('click', () => menuEl.classList.toggle('show'));

    // 元件
    const CATALOG_URL = '/json/json-file.txt'; // 絕對路徑，避免相對路徑差異
    const $hw = document.getElementById('hw');        // 商品分類
    const $sw = document.getElementById('sw');        // 組別
    const $q  = document.getElementById('q');         // 模糊搜尋
    const $table = document.getElementById('listTable');
    const $pager = document.getElementById('pagination');

    // 資料儲存
    let MAP = {};        // { category: [{ order, group, file }] }
    let CAT_ORDER = [];  // 類別顯示順序
    let rawData = [];    // 原始資料（已去掉標題列）
    let viewData = [];   // 搜尋後
    let pageSize = 20;
    let page = 1;

    // 動態欄位（重點）
    let COLS = [];       // 欄位順序（key 陣列）
    let HEADERS = [];    // 欄位標題（顯示文字）

    // 事件
    $hw.addEventListener('change', () => {
      const cat = $hw.value;
      if (cat) { populateGroup(cat); $sw.focus(); } else { populateCategory(); }
    });
    $sw.addEventListener('change', () => {
      const opt  = $sw.options[$sw.selectedIndex];
      const file = opt && opt.getAttribute('data-file');
      if (file) fetchJSON('/json/' + file);
    });
    $q.addEventListener('input', debounce(applySearch, 150));

    // 讀取階層目錄
    async function loadCatalog(){
      try{
        const res = await fetch(CATALOG_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const text = (await res.text()).replace(/^\uFEFF/, ''); // 去 BOM
        MAP = {}; CAT_ORDER = [];
        const lines = text.split(/\r?\n/);

        for (const raw of lines) {
          const line = raw.trim();
          if (!line || line.startsWith('#') || line.startsWith('//')) continue;
          // 格式：order;商品分類:xxx;組別:yyy;file.json（支援全形冒號）
          const m = line.match(/^([^;]+)\s*;\s*商品分類[:：]\s*([^;]+?)\s*;\s*組別[:：]\s*([^;]+?)\s*;\s*([^;]+)\s*$/);
          if (!m) { console.warn('無法解析的行：', line); continue; }

          const [, order, cat, grp, file] = m;
          if (!MAP[cat]) { MAP[cat] = []; CAT_ORDER.push(cat); }
          MAP[cat].push({ order, group: grp, file });
        }

        // 依 order 排序
        Object.keys(MAP).forEach(cat => MAP[cat].sort((a,b) => a.order.localeCompare(b.order)));

        populateCategory();

        // 預設載入第一個分類+組別
        if (CAT_ORDER.length) {
          const firstCat = CAT_ORDER[0];
          $hw.value = firstCat;
          populateGroup(firstCat);
          const first = (MAP[firstCat] || [])[0];
          if (first) { $sw.value = first.group; fetchJSON('/json/' + first.file); }
        }
      }catch(err){
        console.error(err);
        $hw.innerHTML = '<option value="">— 目錄讀取失敗 —</option>';
        $sw.innerHTML = '<option value="">— 目錄讀取失敗 —</option>';
        $sw.disabled = true;
      }
    }

    function populateCategory(){
      $hw.innerHTML = '<option value="">— 請選擇商品分類 —</option>' +
        CAT_ORDER.map(cat => `<option>${safe(cat)}</option>`).join('');
      $sw.innerHTML = '<option value="">— 請先選擇商品分類 —</option>';
      $sw.disabled = true;
    }

    function populateGroup(cat){
      const groups = MAP[cat] || [];
      $sw.innerHTML = '<option value="">— 請選擇組別 —</option>' +
        groups.map(g => `<option data-file="${safe(g.file)}">${safe(g.group)}</option>`).join('');
      $sw.disabled = groups.length === 0;
    }

    // 載入 JSON（動態偵測標題列與欄位）
    async function fetchJSON(path){
      try{
        const res = await fetch(path, { cache:'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('JSON 格式需為陣列');

        if (data.length === 0){
          COLS = []; HEADERS = []; rawData = [];
          applySearch(); // 會清空畫面
          return;
        }

        const first = data[0] || {};
        const second = data[1] || null;
        const keys0 = Object.keys(first);

        // 預期：第一筆是標題列（如新版 a-01-01.json）
        let hasHeaderRow = keys0.length > 0 && keys0.every(k => typeof first[k] === 'string');

        // 簡單排除「其實是資料列」的情況
        if (hasHeaderRow && second){
          const looksSame = keys0.every(k => String(first[k]) === String(second[k]));
          if (looksSame) hasHeaderRow = false;
        }

        COLS = keys0.slice();                                  // 欄位順序 = 第一筆的 key 順序
        HEADERS = hasHeaderRow ? COLS.map(k => first[k])       // 顯示用標題 = 標題列的值
                               : COLS.map(k => k);             // 後援：沒有標題列 → 用 key

        rawData = hasHeaderRow ? data.slice(1) : data.slice(); // 有標題列就跳過第一筆
        page = 1;

        applySearch();
      }catch(err){
        console.error(err);
        rawData = []; viewData = []; COLS = []; HEADERS = [];
        renderDesktopTable(); renderPager();
        $table.innerHTML = '<tr><td>讀取失敗：' + safe(path) + '</td></tr>';
      }
    }

    // 搜尋與渲染
    function applySearch(){
      const kw = ($q.value||'').trim().toLowerCase();
      if(!kw){ viewData = rawData.slice(); }
      else{
        viewData = rawData.filter(row => {
          const txt = Object.values(row).join('\n').toLowerCase();
          return kw.split(/\s+/).every(k => txt.includes(k));
        });
      }
      page = 1;
      renderDesktopTable();
      renderPager();
    }

    function renderDesktopTable(){
      if (!COLS.length){
        $table.innerHTML = '';
        return;
      }
      const head = '<tr>' + HEADERS.map(h => `<th>${safe(h)}</th>`).join('') + '</tr>';
      const rows = pagedData().map(r => {
        const tds = COLS.map(c => `<td>${safe(r[c]) ?? '—'}</td>`).join('');
        return `<tr>${tds}</tr>`;
      }).join('');
      $table.innerHTML = head + rows;
    }


    function renderPager(){
      const total = viewData.length;
      const pages = Math.max(1, Math.ceil(total / pageSize));
      if(page > pages) page = pages;
      let html = '';
      for(let i=1;i<=pages;i++){
        html += (i===page) ? `<button disabled="">${i}</button>` : `<button>${i}</button>`;
      }
      $pager.innerHTML = html;
      Array.from($pager.querySelectorAll('button')).forEach((btn, i) => {
        btn.addEventListener('click', () => { page = i+1; renderDesktopTable(); renderPager(); });
      });
    }

    function pagedData(){ const start = (page-1)*pageSize; return viewData.slice(start, start+pageSize); }
    function safe(v){ if(v==null) return ''; return String(v).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function debounce(fn, wait){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,args),wait); }; }

    // 啟動
    document.addEventListener('DOMContentLoaded', loadCatalog);
  </script>


</body>

</html>
